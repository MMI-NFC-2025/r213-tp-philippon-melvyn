---
import Layout from "../layouts/Layout.astro";
import OfferCard from "../components/OffreCard.astro";

import { getOffres } from "../js/backend.mjs";
const offres = await getOffres();
---

<Layout titre="Offres">
    <section class="max-w-6xl mx-auto px-6 py-8">
        <h1 class="text-2xl font-bold mb-6">Offres</h1>

        <div class="mb-8">
            <button
                id="favori-button"
                class="bg-slate-600 rounded-lg text-white px-4 py-2"
            >
                Afficher les favoris
            </button>
        </div>
        <div
            class="grid gap-6
             grid-cols-1
             sm:grid-cols-2
             lg:grid-cols-3"
        >
            {
                offres.map((offre) => (
                    <div class="offre" data-favori={offre.favori.toString()}>
                        <OfferCard offre={offre} />
                    </div>
                ))
            }
        </div>
    </section>

    <script>
        const button = document.getElementById("favori-button");
        let showOnlyFavorites = false;

        button?.addEventListener("click", () => {
            showOnlyFavorites = !showOnlyFavorites;
            const offres: NodeListOf<HTMLElement> = document.querySelectorAll(".offre");

            offres.forEach((offre) => {
                const isFavori = offre.dataset.favori === "true";

                if (showOnlyFavorites) {
                    offre.style.display = isFavori ? "block" : "none";
                    button.textContent = "Afficher tout";
                } else {
                    offre.style.display = "block";
                    button.textContent = "Afficher les favoris";
                }
            });
        });
    </script>
</Layout>
